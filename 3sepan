<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COLORS - Calculator Game</title>
    <style>
        /* [색상 가이드] 1. 화이트(#FFFFFF) 2. 다크(#2D3436) 3. 그린(#2ED573) */
        :root {
            --bg: #FFFFFF;
            --main: #2D3436;
            --point: #ff3B3B;
        }

        body {
            background-color: var(--bg);
            font-family: 'Pretendard', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: var(--main);
            /* 드래그 및 선택 방지 */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .game-container {
            width: 100%;
            max-width: 440px;
            background: var(--bg);
            padding: 30px;
            border-radius: 40px;
            border: 4px solid var(--main);
        }

        .section-label { font-size: 0.8rem; font-weight: 800; margin-bottom: 10px; display: block; text-transform: uppercase; }
        
        .task-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 25px; }
        .task-num {
            height: 40px; background: var(--bg); border: 2px solid var(--main); border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; color: var(--main); transition: 0.3s;
        }
        .task-num.active { background: var(--point); border-color: var(--point); color: var(--bg); }

        .guide-box {
            background: var(--main); color: var(--bg); padding: 15px; border-radius: 20px;
            font-size: 0.85rem; margin-bottom: 20px;
        }

        .display {
            background: var(--bg); border-radius: 25px; padding: 25px;
            text-align: right; margin-bottom: 20px; border: 4px solid var(--main);
        }
        .display-round { font-size: 0.75rem; font-weight: 700; color: var(--point); margin-bottom: 5px; }
        .display-main { font-size: 2.2rem; font-weight: 800; min-height: 2.5rem; }

        .pad-wrapper { display: flex; gap: 15px; margin-bottom: 15px; }
        .num-pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; flex: 3; }
        .op-pad { display: grid; grid-template-columns: 1fr; gap: 10px; flex: 1; }

        button {
            border: 2px solid var(--main); border-radius: 18px; padding: 18px 0;
            font-size: 1.1rem; font-weight: 700; cursor: pointer;
            transition: 0.2s; background: var(--bg); color: var(--main);
        }
        button:hover:not(:disabled) { background: var(--main); color: var(--bg); }
        button:disabled { opacity: 0.2; cursor: not-allowed; }

        .btn-active-point { background: var(--point); border-color: var(--point); color: var(--bg); }
        .btn-dark { background: var(--main); color: var(--bg); }
        .btn-calc { background: var(--point); color: var(--bg); border-color: var(--point); grid-column: span 2; }

        .footer { display: flex; justify-content: space-between; margin-top: 15px; font-weight: bold; }

        #win-overlay {
            display: none; position: fixed; top:0; left:0; width:100%; height:100%;
            background: var(--main); flex-direction: column; justify-content: center; align-items: center; z-index: 100;
        }
        #win-overlay h1 { color: var(--point); font-size: 2.5rem; }
    </style>
</head>
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">

<div class="game-container">
    <span class="section-label">과제 숫자 (0-9)</span>
    <div class="task-grid" id="taskGrid"></div>

    <div class="guide-box" id="guide">
        <b>1단계</b>: 숫자(3, .) → 연산자 → 숫자를 입력하세요.
    </div>

    <div class="display">
        <div class="display-round" id="stepTag">STEP 1</div>
        <div class="display-main" id="display">0</div>
    </div>

    <div class="pad-wrapper">
        <div class="num-pad">
            <button disabled>1</button><button disabled>2</button><button class="btn-active-point" onclick="pressKey('3')">3</button>
            <button disabled>4</button><button disabled>5</button><button disabled>6</button>
            <button disabled>7</button><button disabled>8</button><button disabled>9</button>
            <button disabled>0</button><button class="btn-active-point" onclick="pressKey('.')">.</button>
            <button onclick="clearInput()">C</button>
        </div>
        <div class="op-pad">
            <button class="btn-dark" onclick="pressOp('+')">+</button>
            <button class="btn-dark" onclick="pressOp('-')">-</button>
            <button class="btn-dark" onclick="pressOp('*')">×</button>
            <button class="btn-dark" onclick="pressOp('/')">÷</button>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 3fr 1fr; gap: 15px;">
        <button class="btn-calc" onclick="calculate()">RUN CALC</button>
        <button class="btn-dark" onclick="resetGame()">RESET</button>
    </div>

    <div class="footer">
        <div id="lifeText">LIFE: ❤️❤️❤️</div>
        <div id="stepText">1 / 3</div>
    </div>
</div>

<div id="win-overlay">
    <h1 id="winMsg"></h1>
    <button onclick="location.reload()" style="background: var(--point); color: var(--bg); padding: 15px 40px; margin-top: 20px; border:none;">RESTART</button>
</div>

<script>
    /* [보안 스크립트: F12 및 단축키 차단] */
    document.onkeydown = function(e) {
        if(e.keyCode == 123) return false; // F12
        if(e.ctrlKey && e.shiftKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0))) return false;
        if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false; // 소스 보기
    };

    let lives = 3;
    let round = 1;
    let prevRes = null;
    let currentInput = "";
    let opUsed = false;
    let solved = new Set();
    const secret = "7IS46rCA7KeA7IOJ6rm565Ok"; 

    function init() {
        const grid = document.getElementById('taskGrid');
        for(let i=0; i<=9; i++) grid.innerHTML += `<div class="task-num" id="t-${i}">${i}</div>`;
        updateUI();
    }

    function pressKey(k) {
        if(lives <= 0) return;
        currentInput += k;
        render();
    }

    function pressOp(op) {
        if(lives <= 0) return;
        if(!opUsed) {
            currentInput += op;
            opUsed = true;
            render();
        } else {
            alert("연산자는 한 번만 사용 가능합니다.");
        }
    }

    function render() {
        const d = document.getElementById('display');
        d.innerText = (round === 1) ? (currentInput || "0") : (prevRes + " " + currentInput);
    }

    function clearInput() {
        currentInput = "";
        opUsed = false;
        render();
    }

    function calculate() {
        if(lives <= 0 || currentInput === "") return;
        try {
            let formula = (round === 1) ? currentInput : prevRes.toString() + currentInput;
            let result = eval(formula);

            if (round < 3) {
                prevRes = result;
                currentInput = "";
                opUsed = false;
                round++;
            } else {
                checkResult(result);
            }
        } catch(e) {
            triggerFail();
        }
        updateUI();
    }

    function checkResult(res) {
        if (Number.isInteger(res) && res >= 0 && res <= 9) {
            solved.add(res);
            document.getElementById(`t-${res}`).classList.add('active');
            alert(`성공! 결과값: ${res}`);
            if (solved.size === 10) showWin();
            resetToStepOne();
        } else {
            triggerFail();
        }
    }

    function triggerFail() {
        alert('실패! 목숨이 하나 줄었습니다');
        document.getElementById('display').innerText = "오류";
        lives--;
        setTimeout(() => {
            resetToStepOne();
            updateUI();
        }, 500);
    }

    function resetToStepOne() {
        round = 1;
        prevRes = null;
        currentInput = "";
        opUsed = false;
        render();
    }

    function resetGame() {
        lives = 3;
        solved.clear();
        document.querySelectorAll('.task-num').forEach(e => e.classList.remove('active'));
        resetToStepOne();
        updateUI();
    }

    function updateUI() {
        document.getElementById('lifeText').innerText = "목숨 : " + "❤️".repeat(lives);
        document.getElementById('stepText').innerText = `판수 ${round} / 3`;
        document.getElementById('stepTag').innerText = `단계 ${round}`;
        
        const g = document.getElementById('guide');
        if(round === 1) g.innerHTML = "<b>삼세판</b>: 세 번의 연산으로 한 자리 정수를 만들어주세요.";
        else g.innerHTML = `<b> ${currentStep}번째 판</b>: 이전 결과 <b>${prevResult}</b>에 이어갈 연산자 → 숫자를 입력하세요.`;
        
        if(lives <= 0) document.getElementById('display').innerText = "게임 오버!";
    }

    function showWin() {
        const ov = document.getElementById('win-overlay');
        document.getElementById('winMsg').innerText = decodeURIComponent(atob(secret).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
        ov.style.display = 'flex';
    }

    init();
</script>
</body>
</html>
