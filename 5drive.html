<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Alphabet Drive: Pro Edition</title>
    <style>
        :root {
            --c1: #000000; --c2: #f8f9fa; --c3: #ff4d4d; 
            --c4: #ffeb3b; --c5: #4caf50;
        }

        body {
            background-color: #1a1a1a; color: var(--c2);
            display: flex; flex-direction: column; align-items: center;
            font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; overflow-x: hidden;
        }

        #traffic-ui-box { display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; }
        #traffic-light-housing {
            display: flex; gap: 15px; background: #222; padding: 15px 30px;
            border-radius: 60px; border: 4px solid #444; box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .light {
            width: 50px; height: 50px; border-radius: 50%; background: #111;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: bold; color: rgba(255,255,255,0.05); transition: all 0.2s;
        }
        .light.active[data-type="stop"] { background: var(--c3); color: #fff; box-shadow: 0 0 25px var(--c3); }
        .light.active[data-type="warn"] { background: var(--c4); color: #000; box-shadow: 0 0 25px var(--c4); }
        .light.active[data-type="left"], .light.active[data-type="straight"], .light.active[data-type="right"] { 
            background: var(--c5); color: #fff; box-shadow: 0 0 25px var(--c5); 
        }

        #game-container { position: relative; background: #333; border: 10px solid #444; border-radius: 15px; }
        canvas { display: block; }

        .controls {
            margin-top: 25px; display: flex; flex-direction: column; align-items: center;
            gap: 20px; background: #2a2a2a; padding: 20px; border-radius: 20px;
        }
        .car-selector { display: flex; gap: 15px; }
        .car-btn {
            width: 60px; height: 60px; border: 4px solid transparent; cursor: pointer;
            border-radius: 15px; font-weight: 900; font-size: 1.2rem; transition: 0.3s;
        }
        .active-car { border-color: var(--c4) !important; transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        #reset-btn {
            padding: 12px 50px; background: var(--c3); color: white; border: none;
            border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1rem;
        }
    </style>
</head>
<body>

    <div id="traffic-ui-box">
        <div id="traffic-light-housing">
            <div id="light-stop" data-type="stop" class="light">●</div>
            <div id="light-warn" data-type="warn" class="light">●</div>
            <div id="light-left" data-type="left" class="light">←</div>
            <div id="light-straight" data-type="straight" class="light">↑</div>
            <div id="light-right" data-type="right" class="light">→</div>
        </div>
    </div>

    <div id="game-container"><canvas id="gridCanvas"></canvas></div>

    <div class="controls">
        <div class="car-selector">
            <button id="btn-W" class="car-btn" style="background:var(--c1); color:#fff;" onclick="selectCar('#000000')">E</button>
            <button id="btn-G" class="car-btn" style="background:var(--c2); color:#000;" onclick="selectCar('#f8f9fa')">S</button>
            <button id="btn-B" class="car-btn" style="background:var(--c3); color:#fff;" onclick="selectCar('#ff4d4d')">I</button>
            <button id="btn-P" class="car-btn" style="background:var(--c4); color:#fff;" onclick="selectCar('#ffeb3b')">A</button>
            <button id="btn-O" class="car-btn" style="background:var(--c5); color:#fff;" onclick="selectCar('#4caf50')">R</button>
        </div>
        <button id="reset-btn" onclick="resetGame()">초기화</button>
    </div>

<script>
    const canvas = document.getElementById('gridCanvas');
    const ctx = canvas.getContext('2d');
    const gridSize = 9, spacing = 70;
    canvas.width = (gridSize + 1) * spacing;
    canvas.height = (gridSize + 1) * spacing;

    const carConfigs = {
        '#000000': { startX: 2, startY: 2, dx: 1, dy: 0, icon: '→', btnId: 'btn-W' },
        '#f8f9fa': { startX: 3, startY: 4, dx: 0, dy: 1, icon: '↓', btnId: 'btn-G' },
        '#ff4d4d': { startX: 3, startY: 4, dx: 1, dy: 0, icon: '→', btnId: 'btn-B' },
        '#ffeb3b': { startX: 3, startY: 6, dx: 1, dy: 0, icon: '→', btnId: 'btn-P' },
        '#4caf50': { startX: 7, startY: 2, dx: 0, dy: 1, icon: '↓', btnId: 'btn-O' }
    };

    let selectedColor = '#000000';
    let currentPos = { x: 5, y: 5 };
    let rotation = 0, paths = [], isFirstMove = true;
    const trafficMap = {};

    function setTraffic(carColor, x, y, dx, dy, config) {
        trafficMap[`${carColor},${x},${y},${dx},${dy}`] = config;
    }

    function setupIndividualSignals() {
        setTraffic('#000000', 2, 2, 1, 0, { straight: true });
        setTraffic('#000000', 3, 2, 1, 0, { straight: true });
        setTraffic('#000000', 4, 2, 1, 0, { straight: true });
        setTraffic('#000000', 5, 2, 1, 0, { straight: true });
        setTraffic('#000000', 6, 2, 1, 0, { straight: true });
        setTraffic('#000000', 7, 2, 1, 0, { straight: true, warn: true });
        setTraffic('#000000', 8, 2, 1, 0, { stop: true });
        
        setTraffic('#f8f9fa', 3, 4, 0, 1, { straight: true });
        setTraffic('#f8f9fa', 3, 5, 0, 1, { straight : true });
        setTraffic('#f8f9fa', 3, 6, 0, 1, { warn: true, straight : true });
        setTraffic('#f8f9fa', 3, 7, 0, 1, { stop: true });
        
        setTraffic('#ff4d4d', 3, 4, 1, 0, { straight: true });
        setTraffic('#ff4d4d', 4, 4, 1, 0, { warn : true, straight : true });
        setTraffic('#ff4d4d', 5, 4, 1, 0, { stop : true, right : true });
        
        setTraffic('#ff4d4d', 5, 5, 0, 1, { straight : true });
        setTraffic('#ff4d4d', 5, 6, 0, 1, { warn : true, straight : true });
        setTraffic('#ff4d4d', 5, 7, 0, 1, { stop: true });
        
        // [버그 수정] 색상 코드를 #ff2b3b에서 #ffeb3b로 변경
        setTraffic('#ffeb3b', 3, 6, 1, 0, { straight : true });
        setTraffic('#ffeb3b', 4, 6, 1, 0, { warn : true, straight : true });        
        setTraffic('#ffeb3b', 5, 6, 1, 0, { stop : true });
        
        setTraffic('#4caf50', 7, 2, 0, 1, { straight: true });        
        setTraffic('#4caf50', 7, 3, 0, 1, { straight: true });        
        setTraffic('#4caf50', 7, 4, 0, 1, { straight: true });        
        setTraffic('#4caf50', 7, 5, 0, 1, { straight: true });
        
        setTraffic('#4caf50', 7, 6, 0, 1, { straight: true });
        setTraffic('#4caf50', 7, 7, 0, 1, { straight: true, warn : true});      
        setTraffic('#4caf50', 7, 8, 0, 1, { stop : true, right : true });
        setTraffic('#4caf50', 6, 8, -1, 0, { stop : true });
    }

    // --- 나머지 함수들은 동일 ---
    function drawRoads() {
        ctx.fillStyle = '#333'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = '#444'; ctx.lineWidth = 50;
        for(let i=1; i<=gridSize; i++) {
            ctx.beginPath(); ctx.moveTo(spacing, i * spacing); ctx.lineTo(canvas.width - spacing, i * spacing); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(i * spacing, spacing); ctx.lineTo(i * spacing, canvas.height - spacing); ctx.stroke();
        }
    }

    function drawPaths() {
        if (paths.length < 2) return;
        ctx.strokeStyle = '#f8f9fa'; ctx.lineWidth = 8; ctx.lineCap = 'round'; ctx.lineJoin = 'round';
        ctx.beginPath(); ctx.moveTo(paths[0].x * spacing, paths[0].y * spacing);
        for(let i=1; i<paths.length; i++) ctx.lineTo(paths[i].x * spacing, paths[i].y * spacing);
        ctx.stroke();
    }

    function drawCar() {
        const config = carConfigs[selectedColor];
        if(!config) return;
        const x = currentPos.x * spacing, y = currentPos.y * spacing;
        ctx.save(); ctx.translate(x, y); ctx.rotate(rotation);
        ctx.fillStyle = selectedColor; ctx.shadowBlur = 15; ctx.shadowColor = selectedColor;
        ctx.fillRect(-15, -25, 30, 50);
        ctx.fillStyle = 'rgba(0,0,0,0.4)'; ctx.fillRect(-11, -15, 22, 12);
        ctx.fillStyle = '#fff'; ctx.fillRect(-12, -27, 8, 5); ctx.fillRect(4, -27, 8, 5);
        ctx.restore();
    }

    function drawGuide() {
        if (!isFirstMove) return;
        const config = carConfigs[selectedColor];
        if(!config) return;
        ctx.save(); ctx.font = "bold 40px Arial"; ctx.fillStyle = "#fff"; ctx.textAlign = "center";
        ctx.globalAlpha = Math.abs(Math.sin(Date.now() / 400));
        ctx.fillText(config.icon, currentPos.x * spacing + config.dx * 60, currentPos.y * spacing + config.dy * 60);
        ctx.restore();
    }

    function updateTrafficLights(dx, dy) {
        document.querySelectorAll('.light').forEach(l => l.classList.remove('active'));
        const config = trafficMap[`${selectedColor},${currentPos.x},${currentPos.y},${dx},${dy}`];
        if (config) {
            if (config.stop) document.getElementById('light-stop').classList.add('active');
            if (config.warn) document.getElementById('light-warn').classList.add('active');
            if (config.left) document.getElementById('light-left').classList.add('active');
            if (config.straight) document.getElementById('light-straight').classList.add('active');
            if (config.right) document.getElementById('light-right').classList.add('active');
        } else {
            document.getElementById('light-stop').classList.add('active');
        }
    }

    function move(dx, dy, angle) {
        if (isFirstMove) {
            const allowed = carConfigs[selectedColor];
            if (dx !== allowed.dx || dy !== allowed.dy) return;
            isFirstMove = false;
        }
        const nextX = currentPos.x + dx, nextY = currentPos.y + dy;
        if(nextX >= 1 && nextX <= gridSize && nextY >= 1 && nextY <= gridSize) {
            currentPos = { x: nextX, y: nextY };
            rotation = angle; paths.push({...currentPos});
            updateTrafficLights(dx, dy);
        }
    }

    function selectCar(color) {
        if(!carConfigs[color]) return;
        selectedColor = color;
        document.querySelectorAll('.car-btn').forEach(btn => btn.classList.remove('active-car'));
        document.getElementById(carConfigs[color].btnId).classList.add('active-car');
        resetGame();
    }

    function resetGame() {
        const config = carConfigs[selectedColor];
        currentPos = { x: config.startX, y: config.startY };
        paths = [{...currentPos}]; rotation = 0; isFirstMove = true;
        document.querySelectorAll('.light').forEach(l => l.classList.remove('active'));
    }

    function render() {
        drawRoads(); drawPaths(); drawGuide(); drawCar();
        requestAnimationFrame(render);
    }

    window.addEventListener('keydown', (e) => {
        if(e.key === 'ArrowUp') move(0, -1, 0);
        if(e.key === 'ArrowDown') move(0, 1, Math.PI);
        if(e.key === 'ArrowLeft') move(-1, 0, -Math.PI/2);
        if(e.key === 'ArrowRight') move(1, 0, Math.PI/2);
    });

    setupIndividualSignals();
    selectCar('#000000');
    render();
</script>
</body>
</html>
